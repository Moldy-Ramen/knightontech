"use strict";(()=>{var e={};e.id=212,e.ids=[212],e.modules={248:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{default:()=>i});var o=t(5035),s=e([o]);async function i(e,r){if("POST"!==e.method)return console.warn("⚠️  Method not allowed:",e.method),r.status(405).json({error:"Method not allowed"});console.log("\uD83D\uDEF0️  Received POST /api/shipping-estimate with:",JSON.stringify(e.body,null,2));let{name:t,phone:n,address:s}=e.body;if(!s?.line1||!s?.postal_code||!s?.city||!s?.state||!s?.country)return console.error("❌ Missing required address fields:",JSON.stringify(s,null,2)),r.status(400).json({error:"Missing required address fields"});let i=process.env.EASYPOST_API_KEY;if(console.log("\uD83D\uDD11 Loaded EASYPOST_API_KEY:",i?"(exists)":"(undefined)"),!i)return console.error("❌ EASYPOST_API_KEY is undefined or empty"),r.status(500).json({error:"Server misconfiguration: missing EASYPOST_API_KEY"});let a={shipment:{to_address:{name:t||"",phone:n||"",street1:s.line1,city:s.city,state:s.state,zip:s.postal_code,country:s.country},from_address:{name:"Knighton Tech",street1:"3182 S Buena Verde Ln",city:"Magna",state:"UT",zip:"84044",country:"US",phone:"8017971570"},parcel:{length:22.5,width:12,height:22.5,weight:640},options:{currency:"USD"}}};console.log("\uD83D\uDCE4 Sending to EasyPost:",JSON.stringify(a,null,2));try{let e=await (0,o.default)("https://api.easypost.com/v2/shipments",{method:"POST",headers:{Authorization:`Bearer ${i}`,"Content-Type":"application/json"},body:JSON.stringify(a)}),t=await e.json();if(console.log(`📥 EasyPost responded (status ${e.status}):`,JSON.stringify(t,null,2)),t.error){let e="";return e="object"==typeof t.error?t.error.message||JSON.stringify(t.error):t.error,console.error("❌ EasyPost validation error:",e),r.status(400).json({error:e})}if(!t.rates||0===t.rates.length)return console.error("❌ No rates array returned from EasyPost"),r.status(404).json({error:"No shipping rates found"});let n=t.rates.map(e=>({id:e.id,service:e.service,carrier:e.carrier,rate:e.rate,delivery_days:e.delivery_days,estimated_delivery:e.est_delivery_date}));return console.log("✅ Returning rates:",JSON.stringify(n,null,2)),r.status(200).json({rates:n})}catch(e){return console.error("❌ Shipping estimate internal error:",e),r.status(500).json({error:"Internal Server Error"})}}o=(s.then?(await s)():s)[0],n()}catch(e){n(e)}})},3480:(e,r,t)=>{e.exports=t(5600)},5035:e=>{e.exports=import("node-fetch")},5600:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6435:(e,r)=>{Object.defineProperty(r,"M",{enumerable:!0,get:function(){return function e(r,t){return t in r?r[t]:"then"in r&&"function"==typeof r.then?r.then(r=>e(r,t)):"function"==typeof r&&"default"===t?r:void 0}}})},6732:(e,r,t)=>{t.a(e,async(e,n)=>{try{t.r(r),t.d(r,{config:()=>u,default:()=>l,routeModule:()=>c});var o=t(3480),s=t(8667),i=t(6435),a=t(248),d=e([a]);a=(d.then?(await d)():d)[0];let l=(0,i.M)(a,"default"),u=(0,i.M)(a,"config"),c=new o.PagesAPIRouteModule({definition:{kind:s.A.PAGES_API,page:"/api/shipping-estimate",pathname:"/api/shipping-estimate",bundlePath:"",filename:""},userland:a});n()}catch(e){n(e)}})},8667:(e,r)=>{Object.defineProperty(r,"A",{enumerable:!0,get:function(){return t}});var t=function(e){return e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE",e.IMAGE="IMAGE",e}({})}};var r=require("../../webpack-api-runtime.js");r.C(e);var t=r(r.s=6732);module.exports=t})();